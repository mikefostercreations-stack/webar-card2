<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>Mike Foster Creations — WebAR (NFT)</title>

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- AR.js for A-Frame with NFT support -->
  <!-- If this CDN ever fails, try: https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js -->
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>

  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; background: #000; }
    #tapToStart {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-size: 1.25rem;
      letter-spacing: 0.02em;
    }
    #tapToStart.hidden { display: none; }
    .hint {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      opacity: 0.85;
      background: rgba(0,0,0,0.35);
      padding: 6px 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div id="tapToStart" class="hidden">Tap to enable video playback</div>
  <div class="hint">Point your camera at the target image</div>

  <div id="camStatus" style="position:fixed;top:10px;left:10px;background:rgba(0,0,0,.6);color:#fff;padding:8px 10px;border-radius:8px;font:14px system-ui;z-index:9999;">
  Checking camera…
</div>

<script>
(async () => {
  const status = document.getElementById('camStatus');
  if (!window.isSecureContext) {
    status.textContent = 'This page is not secure (HTTPS required). Open via https://';
    return;
  }
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    status.textContent = 'Camera API not available in this browser. Try Safari/Chrome.';
    return;
  }
  try {
    // Ask for camera first to surface permission UI and errors
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    // Close stream immediately; AR.js will open it again
    stream.getTracks().forEach(t => t.stop());
    status.textContent = 'Camera OK. Starting AR…';
    // Give AR.js a moment to attach, then hide status
    setTimeout(() => status.remove(), 1200);
    // Now reveal the scene (if you wrap it hidden)
    document.getElementById('arContainer')?.classList.remove('hidden');
  } catch (err) {
    console.error(err);
    status.textContent = 'Camera error: ' + (err && err.message ? err.message : err);
  }
})();
</script>

<style>
  .hidden { display: none; }
</style>

<div id="arContainer" class="hidden">
  <!-- Your existing <a-scene> goes here unchanged -->
  <a-scene
    vr-mode-ui="enabled: false"
    embedded
    renderer="antialias: true; colorManagement: true; physicallyCorrectLights: true"
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
  >
    <a-assets timeout="60000">
      <video
        id="overlayVideo"
        src="assets/media/bowersfire.mp4"
        preload="auto"
        loop
        muted
        playsinline
        webkit-playsinline
        crossorigin="anonymous"
      ></video>
    </a-assets>

    <a-nft
      type="nft"
      url="assets/target/bowers"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5"
      emitevents="true"
    >
      <a-video
        id="videoPlane"
        src="#overlayVideo"
        rotation="-90 0 0"
        position="0 0 0"
        width="0.0635"
        height="0.0889"
        autoplay="false"
      ></a-video>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>
</div>
